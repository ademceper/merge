---
description: Generate DTOs and AutoMapper profiles from entity
allowed-tools:
  - Read
  - Write
  - Glob
---

# Generate DTO

Generate Data Transfer Objects and AutoMapper mapping profile from a domain entity.

## Required Input
- Entity name or file path
- DTO types needed (List, Detail, Create, Update, Patch)

## DTO Types

### 1. List DTO (for GET all endpoints)
Minimal fields for listing:
- Id
- Name/Title
- Key display fields
- Status
- CreatedAt

### 2. Detail DTO (for GET by id endpoints)
Full entity representation:
- All public properties
- Nested DTOs for relationships
- Computed properties

### 3. Create/Update DTO (for POST/PUT)
Input validation fields:
- Required properties only
- No Id (generated by server)
- No audit fields

### 4. Patch DTO (for PATCH)
Nullable fields:
- All properties nullable
- null = don't update

## Templates

### List DTO
```csharp
namespace Merge.Application.{Module}.DTOs;

/// <summary>
/// {Entity} list item DTO.
/// </summary>
public record {Entity}ListDto(
    Guid Id,
    string Name,
    decimal Price,
    string? ImageUrl,
    bool IsActive,
    DateTime CreatedAt
);
```

### Detail DTO
```csharp
namespace Merge.Application.{Module}.DTOs;

/// <summary>
/// {Entity} detail DTO with full information.
/// </summary>
public record {Entity}DetailDto(
    Guid Id,
    string Name,
    string? Description,
    decimal Price,
    string Currency,
    int StockQuantity,
    bool IsActive,

    // Nested DTOs
    CategoryDto Category,
    List<ImageDto> Images,
    List<ReviewSummaryDto> Reviews,

    // Computed
    decimal AverageRating,
    int ReviewCount,

    // Audit
    DateTime CreatedAt,
    DateTime? LastModifiedAt
);
```

### Patch DTO
```csharp
namespace Merge.Application.{Module}.DTOs;

/// <summary>
/// {Entity} partial update DTO.
/// Null values mean "don't update this field".
/// </summary>
public record Patch{Entity}Dto(
    string? Name,
    string? Description,
    decimal? Price,
    int? StockQuantity,
    bool? IsActive
);
```

### AutoMapper Profile
```csharp
namespace Merge.Application.{Module}.Mappings;

/// <summary>
/// {Entity} mapping profile.
/// </summary>
public class {Entity}MappingProfile : Profile
{
    public {Entity}MappingProfile()
    {
        // Entity -> List DTO
        CreateMap<{Entity}, {Entity}ListDto>()
            .ForMember(d => d.ImageUrl, opt => opt.MapFrom(
                src => src.Images.FirstOrDefault(i => i.IsPrimary).Url));

        // Entity -> Detail DTO
        CreateMap<{Entity}, {Entity}DetailDto>()
            .ForMember(d => d.Price, opt => opt.MapFrom(src => src.Price.Amount))
            .ForMember(d => d.Currency, opt => opt.MapFrom(src => src.Price.Currency))
            .ForMember(d => d.AverageRating, opt => opt.MapFrom(
                src => src.Reviews.Any() ? src.Reviews.Average(r => r.Rating) : 0))
            .ForMember(d => d.ReviewCount, opt => opt.MapFrom(
                src => src.Reviews.Count));

        // Entity -> Simple DTO
        CreateMap<{Entity}, {Entity}Dto>();

        // Nested mappings
        CreateMap<Category, CategoryDto>();
        CreateMap<Image, ImageDto>();
    }
}
```

## Steps

1. Read the entity file
2. Identify all properties
3. Identify value objects (Money, Email, etc.)
4. Identify relationships
5. Generate appropriate DTOs
6. Generate AutoMapper profile
7. Place in correct folders

## Folder Structure
```
Merge.Application/{Module}/
├── DTOs/
│   ├── {Entity}Dto.cs
│   ├── {Entity}ListDto.cs
│   ├── {Entity}DetailDto.cs
│   └── Patch{Entity}Dto.cs
└── Mappings/
    └── {Entity}MappingProfile.cs
```

## Guidelines

- Use records for immutability
- Flatten value objects in DTOs
- Don't expose domain internals
- Include XML documentation
- Handle nullables properly
- Use projection for list DTOs
